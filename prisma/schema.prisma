generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id            String       @id @default(cuid())
  email         String       @unique
  password      String
  name          String?
  replicateKey  String?      @db.Text
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt
  prompts       Prompt[]
  generations   Generation[]
  characters    Character[]
  stylePresets  StylePreset[]
  styleOptions  StyleOption[]
  customStyleOptions  CustomStyleOption[] // deprecated
}

model StylePreset {
  id                  String   @id @default(cuid())
  name                String
  description         String?
  icon                String?  @default("ğŸ¬")

  // ìŠ¤íƒ€ì¼ ì˜µì…˜
  genre               String
  customGenre         String?
  mood                String
  customMood          String?
  visualStyle         String
  lightingStyle       String?  @default("natural")
  cameraAngle         String
  shotSize            String
  cameraMovement      String
  pacing              String
  transitionStyle     String
  colorGrade          String
  timeSetting         String
  weatherSetting      String?  @default("clear")
  format              String
  duration            String

  // ì„ íƒëœ ìºë¦­í„° ID ë°°ì—´
  characterIds        Json?

  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  userId              String
  user                User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([createdAt])
}

model Character {
  id              String   @id @default(cuid())
  name            String
  description     String?  @db.Text
  role            String?  // "ì£¼ì¸ê³µ" | "ì¡°ì—°" | "ì—‘ìŠ¤íŠ¸ë¼" | "ì•…ë‹¹" | "ê¸°íƒ€"
  gender          String?  // "ë‚¨ì„±" | "ì—¬ì„±" | "ê¸°íƒ€"
  age             String?  // "ì•„ê¸°" | "ì–´ë¦°ì´" | "ì²­ì†Œë…„" | "ì²­ë…„" | "ì¤‘ë…„" | "ë…¸ë…„"
  appearance      String?  @db.Text  // ì™¸ëª¨ ìƒì„¸ ì„¤ëª…
  clothing        String?  @db.Text  // ì˜ìƒ ìŠ¤íƒ€ì¼
  personality     String?  @db.Text  // ì„±ê²© íŠ¹ì„±
  referenceImages Json?    // ì°¸ì¡° ì´ë¯¸ì§€ URL ë°°ì—´
  generatedImages Json?    // AI ìƒì„± ì´ë¯¸ì§€ URL ë°°ì—´
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  userId          String
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([createdAt])
}

model Prompt {
  id              String   @id @default(cuid())
  name            String
  type            String   // "video" | "image" | "workflow"
  prompt          String   @db.Text
  videoPrompt     String?  @db.Text
  model           String
  imageModel      String?
  videoModel      String?
  referenceImages Json?
  aspectRatio     String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  userId          String
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([type])
  @@index([createdAt])
  @@index([userId])
}

model Generation {
  id          String   @id @default(cuid())
  type        String   // "image" | "video" | "image-to-video" | "workflow"
  prompt      String   @db.Text
  model       String
  resultUrl   String?  @db.Text
  status      String   @default("pending") // "pending" | "processing" | "completed" | "failed"
  error       String?  @db.Text
  metadata    Json?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([type])
  @@index([status])
  @@index([createdAt])
  @@index([userId])
}

// ìŠ¤íƒ€ì¼ ì˜µì…˜ (ì‹œìŠ¤í…œ ê¸°ë³¸ê°’ + ì‚¬ìš©ì ì»¤ìŠ¤í…€)
model StyleOption {
  id          String   @id @default(cuid())
  type        String   // "genre" | "mood" | "visualStyle" | "lightingStyle" | "cameraAngle" | "shotSize" | "cameraMovement" | "pacing" | "transitionStyle" | "colorGrade" | "timeSetting" | "weatherSetting" | "format" | "duration"
  optionId    String   // ì˜µì…˜ ê³ ìœ  ID (ì˜ˆ: "cinematic", "custom-my-genre")
  name        String   // í‘œì‹œ ì´ë¦„
  description String?  // ì„¤ëª…
  icon        String?  @default("ğŸ¬") // ì´ëª¨ì§€ ì•„ì´ì½˜
  isSystem    Boolean  @default(false) // ì‹œìŠ¤í…œ ê¸°ë³¸ ì˜µì…˜ ì—¬ë¶€
  sortOrder   Int      @default(0) // ì •ë ¬ ìˆœì„œ
  metadata    Json?    // ì¶”ê°€ ë°ì´í„° (formatì˜ aspectRatio, durationì˜ seconds ë“±)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  userId      String?  // nullì´ë©´ ì‹œìŠ¤í…œ ì˜µì…˜, ìˆìœ¼ë©´ ì‚¬ìš©ì ì»¤ìŠ¤í…€
  user        User?    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([type, optionId, userId]) // ê°™ì€ íƒ€ì… ë‚´ì—ì„œ ì˜µì…˜ID ì¤‘ë³µ ë°©ì§€
  @@index([type])
  @@index([userId])
  @@index([isSystem])
}

// ê¸°ì¡´ CustomStyleOptionì€ StyleOptionìœ¼ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜ í›„ ì‚­ì œ ì˜ˆì •
model CustomStyleOption {
  id          String   @id @default(cuid())
  type        String
  optionId    String
  name        String
  description String?
  icon        String?  @default("ğŸ¬")
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, type, optionId])
  @@index([userId])
  @@index([type])
}
